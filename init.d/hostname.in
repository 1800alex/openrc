#!@PREFIX@/sbin/runscript
# Copyright (c) 2007-2009 Roy Marples <roy@marples.name>
# Released under the 2-clause BSD license.

description="Sets the hostname of the machine."

depend() {
	need root
}

start()
{
	hostname=${hostname-${HOSTNAME-localhost}}
	out=$hostname
	short=${hostname%%.*}
	if [ "$short" != "$hostname" ]; then
		out="$out $short"
	fi
	if [ "$nisdomainname" != "" ]; then
		ebegin "Setting NIS domain name to $nisdomainname"
		nisdomainname $nisdomainname
		eend $? "Failed to set the NIS domain name"
	fi
	if [ "$short" != "localhost" ]; then
		out="$out localhost"
	fi
	if [ "$hostname" != "localhost.localdomain" ]; then
		out="$out localhost.localdomain"
	fi
	[ -n "$aliases" ] && out2="$aliases"
	ebegin "Configuring /etc/hosts"
	cat << END > /etc/hosts
# Local Host Database
#
# This AUTOMATICALLY-GENERATED file describes a number of aliases-to-address
# mappings for the local hosts that share this file.
#
# In the presence of the domain name service or NIS, this file may not be
# consulted at all; see /etc/host.conf for the resolution order.
#
# DO NOT EDIT THIS FILE BY HAND; YOUR CHANGES WILL BE OVERWRITTEN
#
# Define alias-to-address mappings in /etc/conf.d/hostname

# IPv4 and IPv6 localhost aliases
127.0.0.1	$out
::1		$out

# Other aliases
$out2
END
	chmod 0644 /etc/hosts
	eend $?
	[ "$RC_SYS" = "LXC" ] && return 0
	ebegin "Setting hostname to $hostname"
	hostname "$short"
	eend $? "Failed to set the hostname"
}
